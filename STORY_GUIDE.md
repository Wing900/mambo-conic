# æ•…äº‹è„šæœ¬ç¼–å†™æŒ‡å—

## ğŸ“– ç°æœ‰æ¶æ„åˆ†æ

ä½ çš„é¡¹ç›®ä½¿ç”¨**JSONé©±åŠ¨çš„åœºæ™¯ç³»ç»Ÿ**ï¼Œé€šè¿‡ [`SceneEngine`](mambo-conic/src/utils/SceneEngine.ts) è§£æå‰§æœ¬ï¼ŒçŠ¶æ€ç”± [`useGameStore`](mambo-conic/src/store/useGameStore.ts) ç®¡ç†ã€‚

### æ ¸å¿ƒæœºåˆ¶
- **åœºæ™¯ç±»å‹**: `dialogue`ï¼ˆå¯¹è¯ï¼‰ã€`choice`ï¼ˆé€‰æ‹©é¢˜ï¼‰
- **åœºæ™¯è·³è½¬**: é€šè¿‡ `next` å­—æ®µæˆ–é€‰é¡¹çš„ `next` å®ç°
- **çŠ¶æ€è¿½è¸ª**: å¾—åˆ†ã€å¥½æ„Ÿåº¦ã€å®Œæˆåœºæ™¯åˆ—è¡¨

---

## ğŸ¯ æ¨èçš„æ•…äº‹ç»„ç»‡æ–¹å¼

### æ–¹æ¡ˆï¼šæŒ‰ç« èŠ‚åˆ†æ–‡ä»¶ï¼ˆæ¨èï¼‰

```
src/data/scenes/
â”œâ”€â”€ chapter01.json  - æ¤­åœ†å…¥é—¨
â”œâ”€â”€ chapter02.json  - æ¤­åœ†è¿›é˜¶
â”œâ”€â”€ chapter03.json  - åŒæ›²çº¿
â”œâ”€â”€ chapter04.json  - æŠ›ç‰©çº¿
â””â”€â”€ special.json    - ç‰¹æ®Šåœºæ™¯ï¼ˆå¼€åœºã€ç»“å±€ã€æˆå°±ç­‰ï¼‰
```

**ä¼˜ç‚¹ï¼š**
- âœ… æ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤
- âœ… å¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸€ç« èŠ‚
- âœ… å›¢é˜Ÿåä½œæ—¶å‡å°‘å†²çª
- âœ… ç¬¦åˆä½ ç°æœ‰çš„ [`chapter01.json`](mambo-conic/src/data/scenes/chapter01.json) ç»“æ„

---

## ğŸ“ å•ç« è„šæœ¬ç¼–å†™æµç¨‹

### 1. ç« èŠ‚ç»“æ„æ¨¡æ¿

```json
{
  "chapter": "ç« èŠ‚åç§°",
  "scenes": [
    // åœºæ™¯åˆ—è¡¨
  ]
}
```

### 2. åœºæ™¯ç±»å‹ä¸ç”¨é€”

#### A. å¯¹è¯åœºæ™¯ - æ¨è¿›å‰§æƒ…
```json
{
  "id": "intro_001",
  "type": "dialogue",
  "mambo": {
    "expression": "happy",
    "action": "bounce"
  },
  "dialogue": {
    "speaker": "æ›¼æ³¢",
    "text": "ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ æ¤­åœ†ï¼",
    "speed": 50
  },
  "blackboard": {
    "type": "image",
    "src": "/assets/images/ellipse_intro.png"
  },
  "next": "concept_001"
}
```

#### B. é€‰æ‹©åœºæ™¯ - äº’åŠ¨æµ‹è¯•
```json
{
  "id": "quiz_001",
  "type": "choice",
  "mambo": {
    "expression": "thinking"
  },
  "dialogue": {
    "text": "æ¤­åœ†çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"
  },
  "blackboard": {
    "type": "image",
    "src": "/assets/images/ellipse_question.png"
  },
  "options": [
    {
      "text": "åˆ°ä¸¤ç„¦ç‚¹è·ç¦»ä¹‹å’Œä¸ºå¸¸æ•°",
      "correct": true,
      "next": "correct_001",
      "scoreChange": 10
    },
    {
      "text": "åˆ°ç„¦ç‚¹è·ç¦»ç›¸ç­‰",
      "correct": false,
      "next": "hint_001"
    }
  ]
}
```

#### C. å®éªŒåœºæ™¯ - äº¤äº’æ¢ç´¢
```json
{
  "id": "lab_001",
  "type": "dialogue",
  "mambo": {
    "expression": "excited"
  },
  "dialogue": {
    "text": "æ¥æ‹–åŠ¨ç„¦ç‚¹è¯•è¯•ï¼Œè§‚å¯Ÿæ¤­åœ†çš„å˜åŒ–ï¼"
  },
  "blackboard": {
    "type": "lab",
    "labType": "ellipse"
  },
  "next": "summary_001"
}
```

---

## ğŸ¬ æ•…äº‹è®¾è®¡æœ€ä½³å®è·µ

### 1. ç« èŠ‚ç»“æ„å»ºè®®ï¼ˆæ¯ç«  8-12 ä¸ªåœºæ™¯ï¼‰

```
å¼€åœº (1-2ä¸ªåœºæ™¯)
  â†“
æ¦‚å¿µå¼•å…¥ (2-3ä¸ªåœºæ™¯)
  â†“
äº’åŠ¨ç»ƒä¹  (2-3ä¸ªåœºæ™¯)
  â†“
æ·±å…¥æ¢ç´¢ (2-3ä¸ªåœºæ™¯)
  â†“
æ€»ç»“ (1ä¸ªåœºæ™¯)
```

### 2. åœºæ™¯IDå‘½åè§„èŒƒ

```
{ç« èŠ‚}_{ç±»å‹}_{åºå·}

ä¾‹å¦‚:
- ch01_intro_001   (ç¬¬1ç« å¼€åœº)
- ch01_quiz_001    (ç¬¬1ç« æµ‹éªŒ1)
- ch01_lab_001     (ç¬¬1ç« å®éªŒ1)
- ch02_concept_001 (ç¬¬2ç« æ¦‚å¿µè®²è§£)
```

### 3. è¡¨æƒ…ä½¿ç”¨æŒ‡å—

| è¡¨æƒ… | ä½¿ç”¨åœºæ™¯ |
|------|---------|
| `normal` | é»˜è®¤çŠ¶æ€ï¼Œå¹³å’Œè®²è§£ |
| `happy` | å­¦ç”Ÿç­”å¯¹ã€å®Œæˆä»»åŠ¡ |
| `excited` | å¼•å…¥æ–°æ¦‚å¿µã€å®éªŒç¯èŠ‚ |
| `thinking` | æé—®ã€å¼•å¯¼æ€è€ƒ |
| `sad` | å­¦ç”Ÿç­”é”™ï¼ˆæ¸©æŸ”æç¤ºï¼‰|
| `surprised` | æ­ç¤ºæ„å¤–ç»“è®º |

### 4. é»‘æ¿å†…å®¹æ­é…

| åœºæ™¯ç±»å‹ | æ¨èé»‘æ¿å†…å®¹ |
|---------|-------------|
| æ¦‚å¿µå¼•å…¥ | `image` - ç¤ºæ„å›¾ |
| å®šä¹‰è®²è§£ | `math` - LaTeXå…¬å¼ |
| æ¼”ç¤ºè¿‡ç¨‹ | `video` - åŠ¨ç”»è§†é¢‘ |
| åŠ¨æ‰‹æ¢ç´¢ | `lab` - äº¤äº’å®éªŒ |

---

## ğŸ”€ åˆ†æ”¯é€»è¾‘è®¾è®¡

### ç®€å•åˆ†æ”¯ï¼ˆæ¨èæ–°æ‰‹ï¼‰
```
ä¸»çº¿ â†’ æµ‹éªŒ â†’ ç­”å¯¹ â†’ ç»§ç»­
              â†“
            ç­”é”™ â†’ æç¤º â†’ å›åˆ°æµ‹éªŒ
```

### å¤æ‚åˆ†æ”¯ï¼ˆè¿›é˜¶ï¼‰
```
ä¸»çº¿ â†’ é€‰æ‹©A â†’ è·¯å¾„A â†’ æ±‡åˆç‚¹
       â†“
     é€‰æ‹©B â†’ è·¯å¾„B â†—
       â†“
     é€‰æ‹©C â†’ è·¯å¾„C â†—
```

**æ³¨æ„ï¼š** å¤æ‚åˆ†æ”¯éœ€è¦æ›´å¤šåœºæ™¯ï¼Œå¢åŠ ç»´æŠ¤éš¾åº¦ã€‚å»ºè®®å…ˆç”¨ç®€å•åˆ†æ”¯ã€‚

---

## ğŸ“‹ å®Œæ•´ç« èŠ‚ç¤ºä¾‹

### æ¤­åœ†å…¥é—¨ç« èŠ‚ç»“æ„

```json
{
  "chapter": "æ¤­åœ†å…¥é—¨",
  "scenes": [
    {
      "id": "start",
      "type": "dialogue",
      "mambo": { "expression": "happy", "action": "bounce" },
      "dialogue": { "text": "å˜¿ï¼æˆ‘æ˜¯æ›¼æ³¢ï¼Œä»Šå¤©å­¦æ¤­åœ†ï½" },
      "blackboard": { "type": "image", "src": "/intro.png" },
      "next": "concept_01"
    },
    {
      "id": "concept_01",
      "type": "dialogue",
      "mambo": { "expression": "thinking" },
      "dialogue": { "text": "æ¤­åœ†çš„å®šä¹‰æ˜¯..." },
      "blackboard": { 
        "type": "math", 
        "content": "\\frac{x^2}{a^2} + \\frac{y^2}{b^2} = 1" 
      },
      "next": "quiz_01"
    },
    {
      "id": "quiz_01",
      "type": "choice",
      "dialogue": { "text": "æ¤­åœ†æœ‰å‡ ä¸ªç„¦ç‚¹ï¼Ÿ" },
      "options": [
        { "text": "1ä¸ª", "correct": false, "next": "hint_01" },
        { "text": "2ä¸ª", "correct": true, "next": "lab_01", "scoreChange": 10 }
      ]
    },
    {
      "id": "hint_01",
      "type": "dialogue",
      "mambo": { "expression": "sad" },
      "dialogue": { "text": "ä¸å¯¹å“¦ï¼Œå†æƒ³æƒ³ï½" },
      "next": "quiz_01"
    },
    {
      "id": "lab_01",
      "type": "dialogue",
      "mambo": { "expression": "excited" },
      "dialogue": { "text": "æ¥è¯•è¯•æ‹–åŠ¨ç„¦ç‚¹ï¼" },
      "blackboard": { "type": "lab", "labType": "ellipse" },
      "next": "end"
    },
    {
      "id": "end",
      "type": "dialogue",
      "mambo": { "expression": "happy" },
      "dialogue": { "text": "ä»Šå¤©å°±åˆ°è¿™é‡Œï½ä¸‹æ¬¡è§ï¼" },
      "next": null
    }
  ]
}
```

---

## ğŸ› ï¸ å®ç”¨æŠ€å·§

### 1. æµ‹è¯•å•ä¸ªåœºæ™¯
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°
window.store = useGameStore.getState();
window.store.goToScene('your_scene_id');
```

### 2. éªŒè¯åœºæ™¯å®Œæ•´æ€§
[`SceneEngine.validateScenes()`](mambo-conic/src/utils/SceneEngine.ts:49) ä¼šæ£€æŸ¥ï¼š
- âœ… æ‰€æœ‰ `next` å­—æ®µæŒ‡å‘çš„åœºæ™¯æ˜¯å¦å­˜åœ¨
- âœ… é€‰é¡¹çš„ `next` æ˜¯å¦æœ‰æ•ˆ
- âœ… åœºæ™¯ç±»å‹æ˜¯å¦æ­£ç¡®

### 3. å¿«é€Ÿå ä½å†…å®¹
```json
{
  "blackboard": {
    "type": "image",
    "src": "/placeholder.png",
    "alt": "å¾…è¡¥å……å›¾ç‰‡"
  }
}
```

---

## âš ï¸ å¸¸è§é”™è¯¯

### âŒ é”™è¯¯ 1: æ­»å¾ªç¯
```json
{
  "id": "scene_a",
  "next": "scene_b"
},
{
  "id": "scene_b",
  "next": "scene_a"  // ä¼šæ— é™å¾ªç¯ï¼
}
```

### âŒ é”™è¯¯ 2: å­¤ç«‹åœºæ™¯
```json
{
  "id": "orphan_scene",
  // æ²¡æœ‰ä»»ä½•åœºæ™¯çš„ next æŒ‡å‘å®ƒ
}
```

### âŒ é”™è¯¯ 3: ç¼ºå°‘ç»“æŸåœºæ™¯
```json
{
  "id": "last_scene",
  "next": "non_existent"  // ä¸‹ä¸€åœºæ™¯ä¸å­˜åœ¨
}
```

**è§£å†³æ–¹æ¡ˆï¼š** ç« èŠ‚ç»“å°¾ä½¿ç”¨ `"next": null`

---

## ğŸ¨ å†…å®¹åˆ›ä½œå»ºè®®

### å¯¹è¯æ–‡æœ¬
- âœ… ç®€çŸ­æœ‰åŠ›ï¼ˆä¸€æ¬¡å¯¹è¯ 1-2 å¥è¯ï¼‰
- âœ… å£è¯­åŒ–ï¼Œç¬¦åˆæ›¼æ³¢çš„å¯çˆ±æ€§æ ¼
- âœ… é¿å…ä¸“ä¸šæœ¯è¯­å †ç Œ
- âœ… å¤šç”¨é—®å¥å¼•å¯¼æ€è€ƒ

### æ•°å­¦å†…å®¹
- âœ… å…ˆç›´è§‚å›¾åƒï¼Œå†æ•°å­¦å…¬å¼
- âœ… å…¬å¼åˆ†æ­¥å±•ç¤ºï¼Œä¸è¦ä¸€æ¬¡å…¨ç»™
- âœ… å®éªŒåå†æ€»ç»“ç†è®º
- âœ… è”ç³»ç”Ÿæ´»å®ä¾‹

### æµ‹éªŒè®¾è®¡
- âœ… 3-4 ä¸ªé€‰é¡¹æœ€ä½³
- âœ… é”™è¯¯æç¤ºè¦æ¸©æŸ”ä¸”æœ‰æŒ‡å¯¼æ€§
- âœ… æ­£ç¡®ç­”æ¡ˆç»™äºˆé¼“åŠ±
- âœ… é¿å…è¿‡äºç®€å•æˆ–è¿‡éš¾

---

## ğŸ“š æ‰©å±•é˜…è¯»

### å¦‚ä½•æ·»åŠ æ–°ç« èŠ‚
1. åˆ›å»ºæ–°çš„ `chapterXX.json`
2. åœ¨ [`App.tsx`](mambo-conic/src/App.tsx) ä¸­å¯¼å…¥
3. ä¼ é€’ç»™ SceneEngine

### å¦‚ä½•æ·»åŠ æ–°å®éªŒç±»å‹
1. åœ¨ [`labs/`](mambo-conic/src/components/Blackboard/labs/) åˆ›å»ºæ–°ç»„ä»¶
2. åœ¨ [`LabNode.tsx`](mambo-conic/src/components/Blackboard/LabNode.tsx) æ³¨å†Œ
3. åœ¨ [`scene.types.ts`](mambo-conic/src/types/scene.types.ts:14) æ·»åŠ ç±»å‹

### å¦‚ä½•æ·»åŠ æ–°è¡¨æƒ…
1. å‡†å¤‡å¯¹åº”ç«‹ç»˜å›¾ç‰‡
2. åœ¨ [`scene.types.ts`](mambo-conic/src/types/scene.types.ts:2) æ·»åŠ ç±»å‹
3. åœ¨ [`Mambo.tsx`](mambo-conic/src/components/Mambo/Mambo.tsx) å¤„ç†æ¸²æŸ“

---

## âœ… æ£€æŸ¥æ¸…å•

åˆ›å»ºæ–°ç« èŠ‚æ—¶ï¼Œç¡®ä¿ï¼š
- [ ] æœ‰æ˜ç¡®çš„å¼€å§‹åœºæ™¯ï¼ˆid: "start"ï¼‰
- [ ] æœ‰ç»“æŸåœºæ™¯ï¼ˆnext: nullï¼‰
- [ ] æ‰€æœ‰ next å­—æ®µæŒ‡å‘å­˜åœ¨çš„åœºæ™¯
- [ ] åœºæ™¯IDå”¯ä¸€ä¸”æœ‰æ„ä¹‰
- [ ] è¡¨æƒ…ã€åŠ¨ä½œã€é»‘æ¿å†…å®¹æ­é…åˆç†
- [ ] æµ‹éªŒçš„ç­”æ¡ˆéƒ½æœ‰å¯¹åº”çš„åç»­åœºæ™¯
- [ ] è¿è¡Œ `validateScenes()` æ— é”™è¯¯

---

## ğŸ‰ å¼€å§‹åˆ›ä½œå§ï¼

ä½ ç°åœ¨å¯ä»¥ï¼š
1. å¤åˆ¶ [`chapter01.json`](mambo-conic/src/data/scenes/chapter01.json) ä½œä¸ºæ¨¡æ¿
2. ä¿®æ”¹ç« èŠ‚åç§°å’Œåœºæ™¯å†…å®¹
3. æ ¹æ®æ•™å­¦ç›®æ ‡è®¾è®¡äº’åŠ¨æµç¨‹
4. é€æ­¥å®Œå–„å¯¹è¯å’Œè§†è§‰èµ„æº

è®°ä½ï¼š**å…ˆå®Œæˆéª¨æ¶ï¼Œå†æ‰“ç£¨ç»†èŠ‚ï¼**